<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Retro</title>
</head>
<body style="background-color: darkblue;" onkeypress="handleKeypress(m)">
  <p id="monitor"; style="color: white;"></p>

  <script>
    class Card {
      constructor(text) {
        this.text = text;
      }
    }

    class Deck {
      constructor() {
        this.cards = [];
      }

      createDeck(deckData) {
        for (let i = 0; i < deckData.length; i = i+2) {
          for (let j = 0; j < deckData[i]; j++) {
            this.cards.push(new Card(deckData[i+1]));            
          }
        }
      }

      shuffleDeck() {
       let location1, location2, tmp;
       for (let i = 0; i < 1000; i++) {
           location1 = Math.floor((Math.random() * this.cards.length));
           location2 = Math.floor((Math.random() * this.cards.length));
           tmp = this.cards[location1];
           this.cards[location1] = this.cards[location2];
           this.cards[location2] = tmp;
        }
      }

      drawCard() {
        // TODO: Check for no cards left in deck.
        return this.cards.pop();
      }
    }

    class Monitor {
      constructor(monitorElement) {
        this.element = monitorElement;
        this.reset();
      }

      refresh() {
        this.element.innerHTML = this.output;
      }

      reset() {
        this.output = "* Ready *<br>---<br> ";
        this.refresh();
      }

      write(text) {
        this.output = this.output.concat(text);
        this.output = this.output.concat("<br>---<br>")
        this.refresh();
      }
    }

    let movementDeckData = [
          4, 'CONQUER<br>\
              Group A and C Advance, Group B Charge and Group D hold.',
          3, 'ATTACK<br>\
              Group A and C Charge, Group B and D Advance.',
          1, 'ALL OUT ATTACK<br>\
              All groups Charge!',
          2, 'CAUTIOUS ADVANCE<br>\
              The group with a model furthest from a contestable objective \
              Advance. The other groups Hold.',
          2, 'FORTIFY<br>\
              Group A charge, Group C advance and Group B and D hold.'
        ];

    let m = new Monitor(document.getElementById("monitor"));
    let d = new Deck();

    function handleKeypress(monitor){
      let x = event.keyCode;
      let newCard = {};
      // console.log("Key pressed!" + x);
      switch(x) {
        case 49: // 1
          newCard = d.drawCard();
          monitor.write(newCard.text);
        break;
        default:
          monitor.write("Invalid key.");
      }
    }

    m.reset();

    d.createDeck(movementDeckData);
    d.shuffleDeck();

    // TODO: Link this to a key trigger.
    // activeCard = d.drawCard();
    // m.write(activeCard.text);

  </script>
</body>
</html>
