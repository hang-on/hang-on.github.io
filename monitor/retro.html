<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Retro</title>
</head>
<body style="background-color: darkblue;" onkeypress="handleKeypress(m, totalDecks)">
  <p id="monitor"; style="color: white;"></p>

  <script>
    class Card {
      constructor(text) {
        this.text = text;
      }
    }

    class Deck {
      constructor(deckData) {
        this.cards = [];
        this.deckData = deckData;
        this.createDeck();
        this.shuffleDeck();
      }

      createDeck() {
        for (let i = 0; i < this.deckData.length; i = i+2) {
          for (let j = 0; j < this.deckData[i]; j++) {
            this.cards.push(new Card(this.deckData[i+1]));            
          }
        }
      }

      shuffleDeck() {
       let location1, location2, tmp;
       for (let i = 0; i < 1000; i++) {
           location1 = Math.floor((Math.random() * this.cards.length));
           location2 = Math.floor((Math.random() * this.cards.length));
           tmp = this.cards[location1];
           this.cards[location1] = this.cards[location2];
           this.cards[location2] = tmp;
        }
      }

      drawCard() {
        // TODO: Check for no cards left in deck.
        if (this.cards.length == 0) {
          this.createDeck(this.deckData);
          this.shuffleDeck();
          alert ("Deck shuffled.");
        }
        return this.cards.pop();
      }
    }

    class Monitor {
      constructor(monitorElement) {
        this.element = monitorElement;
        this.reset();
      }

      refresh() {
        this.element.innerHTML = this.output;
      }

      reset() {
        this.output = "* Ready *<br>---<br> ";
        this.refresh();
      }

      write(text) {
        this.output = this.output.concat(text);
        this.output = this.output.concat("<br>---<br>")
        this.refresh();
        window.scrollBy(0,100);
      }
    }

    let movementDeckData = [
          4, 'CONQUER<br>\
              Group A and C Advance, Group B Engage and Group D Fortify.',
          3, 'FORWARD<br>\
              Group A and C Engage, Group B and D Advance.',
          1, 'ALL OUT ATTACK<br>\
              All groups Engage!',
          2, 'BALANCED APPROACH<br>\
              Group A Engage, Group B and C Advance, and Group D Fortify.',
          1, 'HOLD YOUR GROUND!<br>\
              Group B Advance, and groups A, B and D Fortify!'
            ];

        let abilityDeckData = [
          6, 'NOTHING<br>\
              The unit does not use an ability.',
          3, 'ONSLAUGHT<br>\
              Add 1 to hit rolls for this unit.',
          3, "FURY<br>\
              Increase this unit's Rend characteristic by 1.",
          3, "BESERK<br>\
              Add 1 to the Attacks characteristic of this unit's melee weapons.",
          3, 'FORTITUDE<br>\
              Restore D3 wounds on this unit before attacking.'
        ];


    let m = new Monitor(document.getElementById("monitor"));
    let d = new Deck(movementDeckData);
    let abilityDeck = new Deck(abilityDeckData);
    let totalDecks = [d,abilityDeck];

    function handleKeypress(monitor, decks){
      let x = event.keyCode;
      let newCard = {};
      // console.log("Key pressed!" + x);
      switch(x) {
        case 49: // 1
          newCard = decks[0].drawCard();
          monitor.write(newCard.text);
        break;
        case 50: // 2
          newCard = decks[1].drawCard();
          monitor.write(newCard.text);
        break;

        default:
          monitor.write("Invalid key.");
      }
    }

  </script>
</body>
</html>
